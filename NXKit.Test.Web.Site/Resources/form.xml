<f:form xmlns="http://www.w3.org/2002/xforms"
        xmlns:xsd="http://www.w3.org/2001/XMLSchema"
        xmlns:f="http://schemas.nxkit.org/2014/xforms-layout"
        xmlns:xf="http://www.w3.org/2002/xforms"
        xmlns:ev="http://www.w3.org/2001/xml-events"
        xmlns:d="urn::data">
    <model id="data">

        <instance id="misc">
            <data xmlns="urn::data">
                <secondary>false</secondary>
            </data>
        </instance>

        <bind ref="instance('misc')/d:secondary"
              type="xsd:boolean" />

        <instance id="primaryperson"
                  src="primaryperson.xml" />

        <bind ref="instance('primaryperson')">
            <bind ref="d:heightfeet"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:heightinches"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:weight"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:gender"
                  required="true()"
                  type="xsd:string"/>
            <bind ref="d:dateofbirth"
                  required="true()"
                  type="xsd:date"/>
            <bind ref="d:socialsecuritynumber"
                  required="true()"
                  constraint="matches(., '^(\d{3}-\d{2}-\d{4})|(\d{9})$')"/>
            <bind ref="d:telephone1"
                  required="true()"
                  constraint="string-length()>=10"/>
            <bind ref="d:telephone2"
                  required="false()"
                  constraint=".='' or string-length()>=10" />
        </bind>


        <instance id="secondaryperson"
                  src="secondaryperson.xml" />

        <bind ref="instance('secondaryperson')"
              id="secondary"
              relevant="instance('misc')/d:secondary = 'true'">
            <bind ref="d:heightfeet"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:heightinches"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:weight"
                  required="true()"
                  type="xsd:int"/>
            <bind ref="d:dateofbirth"
                  type="xsd:date"/>
        </bind>

        <instance id="primaryelections"
                  src="primaryelections.xml" />

        <instance id="secondaryelections"
                  src="secondaryelections.xml" />

        <instance id="primaryquestions"
                  src="questions.xml" />

        <bind ref="instance('primaryquestions')">
            <bind ref="//d:healthinfo"
                  relevant="../d:answer='true' and ./@enable='true'" />
            <bind ref="//d:healthinfo/*"
                  type="xsd:string" />
        </bind>

        <instance id="secondaryquestions"
                  src="questions.xml" />

        <bind ref="instance('secondaryquestions')"
              relevant="instance('misc')/d:secondary='true'">
            <bind ref="//d:healthinfo"
                  relevant="../d:answer='true' and ./@enable='true'" />
            <bind ref="//d:healthinfo/*"
                  type="xsd:string" />
        </bind>

        <instance id="relationships"
                  src="relationships.xml" />

        <instance id="beneficiaries"
                  src="beneficiaries.xml" />

        <bind ref="instance('beneficiaries')//d:percentage"
              type="xsd:integer" />

        <submission ref="instance('primaryperson')"
                    method="put"
                    action="primaryperson.xml" />
        <submission ref="instance('secondaryperson')"
                    method="put"
                    action="secondaryperson.xml" />
        <submission ref="instance('primaryelections')"
                    method="put"
                    action="primaryelections.xml" />
        <submission ref="instance('secondaryelections')"
                    method="put"
                    action="secondaryelections.xml" />
        <submission ref="instance('primaryquestions')"
                    method="put"
                    action="primaryquestions.xml" />
        <submission ref="instance('secondaryquestions')"
                    method="put"
                    action="secondaryquestions.xml" />
        <submission ref="instance('beneficiaries')"
                    method="put"
                    action="beneficiaries.xml" />
    </model>
    <f:section>
        <label>Primary Enrollment</label>
        <group ref="instance('primaryperson')">
            <label>Additional Information About You</label>
            <help>Complete the form by providing your physical characterists, personal information, and contact information.</help>
            <group>
                <label>Physical Characteristics</label>
                <range ref="d:heightfeet"
                       start="2"
                       end="15"
                       step="1">
                    <label>Feet</label>
                </range>
                <range ref="d:heightinches"
                       start="0"
                       end="11"
                       step="1">
                    <label>Inches</label>
                </range>
                <range ref="d:weight"
                       start="50"
                       end="500"
                       step="5">
                    <label>Weight</label>
                </range>
                <select1 ref="d:gender">
                    <label>Sex</label>
                    <item>
                        <label>Male</label>
                        <value>M</value>
                    </item>
                    <item>
                        <label>Female</label>
                        <value>F</value>
                    </item>
                </select1>
            </group>
            <input ref="d:dateofbirth">
                <label>Date of Birth</label>
                <help>Provide your date of birth to continue.</help>
                <hint appearance="minimal">mm/dd/yyyy</hint>
            </input>
            <input ref="d:socialsecuritynumber">
                <label>Social Security Number</label>
                <hint appearance="minimal">___-__-____</hint>
                <alert>Your social security number is required to continue.</alert>
            </input>
            <group>
                <label>Contact Information</label>
                <input ref="d:telephone1">
                    <label>Home Phone</label>
                    <hint appearance="minimal">1 (___) ___-____</hint>
                </input>
                <input ref="d:telephone2">
                    <label>Work Phone</label>
                </input>
            </group>
        </group>
        <group ref="instance('primaryelections')/d:term-life">
            <label>Coverage Election</label>
            <hint>Choose the type of coverage and amounts for which you are applying.</hint>
            <select1 ref="d:coverage-amount"
                     appearance="full">
                <item>
                    <label>$75,000</label>
                    <value>75000</value>
                </item>
                <item>
                    <label>$100,000</label>
                    <value>100000</value>
                </item>
                <item>
                    <label>$150,000</label>
                    <value>150000</value>
                </item>
            </select1>
        </group>
        <group ref="instance('primaryquestions')">
            <label>Health Questions</label>
            <hint>Please answer the following questions by checking “Yes” or “No.”</hint>
            <repeat ref="d:question">
                <select1 ref="d:answer"
                         incremental="true">
                    <label ref="../d:text" />
                    <item>
                        <label>No</label>
                        <value>false</value>
                    </item>
                    <item>
                        <label>Yes</label>
                        <value>true</value>
                    </item>
                </select1>
                <group ref="d:healthinfo">
                    <input ref="d:condition">
                        <label>Condition</label>
                    </input>
                    <input ref="d:dates">
                        <label>Dates</label>
                    </input>
                    <input ref="d:currentstatus">
                        <label>Current Status</label>
                    </input>
                    <input ref="d:physicianname">
                        <label>Physician Name</label>
                    </input>
                    <input ref="d:physicianaddress">
                        <label>Physician Address</label>
                    </input>
                    <input ref="d:physicianphonenumber">
                        <label>Physician Phone Number</label>
                    </input>
                </group>
            </repeat>
        </group>
    </f:section>
    <f:section>
        <label appearance="compact">Spousal Enrollment</label>
        <input ref="instance('misc')/d:secondary">
            <label>Yes, I'd like to take advantage of this offer for my spouse or other partner or whatever and stuff and we will fill in the contents of the rest of this text later.</label>
        </input>
        <group ref="instance('secondaryperson')">
            <label>Spouse Information</label>
            <group>
                <label>Name</label>
                <input ref="d:firstname">
                    <label>First</label>
                </input>
                <input ref="d:middlename">
                    <label>Middle</label>
                </input>
                <input ref="d:lastname">
                    <label>Last</label>
                </input>
            </group>
            <group>
                <label>Physical Characteristics</label>
                <range ref="d:heightfeet"
                       start="2"
                       end="15"
                       step="1">
                    <label>Feet</label>
                </range>
                <range ref="d:heightinches"
                       start="0"
                       end="11"
                       step="1">
                    <label>Inches</label>
                </range>
                <range ref="d:weight"
                       start="50"
                       end="500"
                       step="5">
                    <label>Weight</label>
                </range>
                <select1 ref="d:gender">
                    <label>Sex</label>
                    <item>
                        <label>Male</label>
                        <value>M</value>
                    </item>
                    <item>
                        <label>Female</label>
                        <value>F</value>
                    </item>
                </select1>
            </group>
            <input ref="d:dateofbirth">
                <label>Date of Birth</label>
            </input>
            <input ref="d:socialsecuritynumber">
                <label>Social Security Number</label>
            </input>
        </group>
        <group ref="instance('secondaryelections')/d:term-life">
            <label>Coverage Selection</label>
            <hint>Choose the type of coverage and amounts for which you are applying.</hint>
            <select1 ref="d:coverage-amount">
                <item>
                    <label>$75,000</label>
                    <value>75000</value>
                </item>
                <item>
                    <label>$100,000</label>
                    <value>100000</value>
                </item>
                <item>
                    <label>$150,000</label>
                    <value>150000</value>
                </item>
            </select1>
        </group>
        <group ref="instance('secondaryquestions')">
            <label>Health Questions</label>
            <hint>Please answer the following questions by checking “Yes” or “No.”</hint>
            <repeat ref="d:question">
                <select1 ref="d:answer"
                         incremental="true">
                    <label ref="../d:text" />
                    <item>
                        <label>No</label>
                        <value>false</value>
                    </item>
                    <item>
                        <label>Yes</label>
                        <value>true</value>
                    </item>
                </select1>
                <group ref="d:healthinfo">
                    <input ref="d:condition">
                        <label>Condition</label>
                    </input>
                    <input ref="d:dates">
                        <label>Dates</label>
                    </input>
                    <input ref="d:currentstatus">
                        <label>Current Status</label>
                    </input>
                    <input ref="d:physicianname">
                        <label>Physician Name</label>
                    </input>
                    <input ref="d:physicianaddress">
                        <label>Physician Address</label>
                    </input>
                    <input ref="d:physicianphonenumber">
                        <label>Physician Phone Number</label>
                    </input>
                </group>
            </repeat>
        </group>
    </f:section>
    <f:section>
        <label>Beneficiaries</label>
        <repeat ref="instance('beneficiaries')/d:beneficiary">
            <input ref="d:firstname"
                   appearance="minimal">
                <label />
            </input>
            <input ref="d:middlename"
                   appearance="minimal">
                <label />
            </input>
            <input ref="d:lastname"
                   appearance="minimal">
                <label />
            </input>
            <input ref="d:socialsecuritynumber"
                   appearance="minimal">
                <label />
            </input>
            <input ref="d:telephone"
                   appearance="minimal">
                <label />
            </input>
            <input ref="d:relationship" />
            <range ref="d:percentage"
                   start="0"
                   step="5"
                   end="100">
                <label />
            </range>
        </repeat>
    </f:section>
</f:form>
